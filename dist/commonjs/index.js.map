{"version":3,"sources":["../../temp/index.js"],"names":[],"mappings":";;AAAA,IAAI,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,UAAU,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,oBAAoB,CAAC;;AAEhH,oBAAoB,GAAG,UAAS,CAAC,EAAE;AACjC,SAAO,UAAS,CAAC,EAAE;AACjB,WAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;GACrB,CAAC;CACH,CAAC;;AAEF,oBAAoB,GAAG,UAAS,CAAC,EAAE;AACjC,SAAO,UAAS,CAAC,EAAE;AACjB,WAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;GACrB,CAAC;CACH,CAAC;;AAEF,UAAU,GAAG,UAAS,CAAC,EAAE;AACvB,MAAI,CAAC,CAAC;AACN,GAAC,GAAG,IAAI,QAAQ,EAAE,CAAC;AACnB,GAAC,CAAC,CAAC,CAAC,CAAC;AACL,SAAO,CAAC,CAAC,MAAM,EAAE,CAAC;CACnB,CAAC;;AAEF,oBAAoB,GAAG,UAAS,CAAC,EAAE,CAAC,EAAE;AACpC,MAAI,KAAK,EAAE,OAAO,EAAE,GAAG,CAAC;AACxB,KAAG,GAAG,IAAI,CAAC;AACX,OAAK,GAAG,IAAI,CAAC;AACb,SAAO,GAAG,KAAK,CAAC;AAChB,MAAI;AACF,OAAG,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;AAC9B,WAAO,GAAG,IAAI,CAAC;GAChB,CAAC,OAAO,MAAM,EAAE;AACf,SAAK,GAAG,MAAM,CAAC;GAChB,SAAS;AACR,QAAI,OAAO,EAAE;AACX,OAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;KAChB,MAAM;AACL,OAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;KAClB;GACF;CACF,CAAC;;AAEF,UAAU,GAAG,UAAS,CAAC,EAAE;AACvB,SAAO,OAAO,CAAC,KAAK,UAAU,CAAC;CAChC,CAAC;;AAEF,QAAQ,GAAG,CAAC,YAAW;AACrB,UAAQ,CAAC,UAAU,GAAG,UAAS,MAAM,EAAE;AACrC,QAAI,CAAC,CAAC;AACN,KAAC,GAAG,IAAI,QAAQ,EAAE,CAAC;AACnB,KAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAClB,WAAO,CAAC,CAAC;GACV,CAAC;;AAEF,UAAQ,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE;AAC9B,QAAI,CAAC,CAAC;AACN,KAAC,GAAG,IAAI,QAAQ,EAAE,CAAC;AACnB,KAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACf,WAAO,CAAC,CAAC;GACV,CAAC;;AAEF,WAAS,QAAQ,GAAG;AAClB,QAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;AAED,UAAQ,CAAC,SAAS,CAAC,MAAM,GAAG,YAAW;AACrC,QAAI,IAAI,CAAC,IAAI,KAAK,IAAI,EAAE;AACtB,UAAI,CAAC,IAAI,GAAG,IAAI,OAAO,EAAE,CAAC;KAC3B;AACD,WAAO,IAAI,CAAC,IAAI,CAAC;GAClB,CAAC;;AAEF,UAAQ,CAAC,SAAS,CAAC,WAAW,GAAG,YAAW;AAC1C,WAAO,IAAI,CAAC,IAAI,KAAK,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;GACtD,CAAC;;AAEF,UAAQ,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,WAAW,EAAE;AAC9C,eAAW,CAAC,UAAU,CAAC,oBAAoB,CAAC,IAAI,CAAC,EAAE,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;GAChF,CAAC;;AAEF,UAAQ,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,KAAK,EAAE;AAC3C,QAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;GAC/B,CAAC;;AAEF,UAAQ,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,KAAK,EAAE;AAC3C,QAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;GACtC,CAAC;;AAEF,SAAO,QAAQ,CAAC;CAEjB,CAAA,EAAG,CAAC;;AAEL,OAAO,GAAG,CAAC,YAAW;AACpB,SAAO,CAAC,KAAK,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE;AACtC,QAAI,OAAO,IAAI,IAAI,EAAE;AACnB,aAAO,GAAG,CAAC,CAAC;KACb;AACD,WAAO,UAAU,CAAC,UAAS,CAAC,EAAE;AAC5B,UAAI,QAAQ,CAAC;AACb,cAAQ,GAAG,YAAW;AACpB,4BAAoB,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;OAC/B,CAAC;AACF,gBAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;KAC/B,CAAC,CAAC;GACJ,CAAC;;AAEF,SAAO,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE;AAC7B,WAAO,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;GACtC,CAAC;;AAEF,SAAO,CAAC,UAAU,GAAG,UAAS,MAAM,EAAE;AACpC,WAAO,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,CAAC;GAC7C,CAAC;;AAEF,SAAO,CAAC,QAAQ,GAAG,UAAS,OAAO,EAAE;AACnC,QAAI,MAAM,CAAC;AACX,UAAM,GAAG,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;AAChC,WAAO,CAAC,OAAO,CAAC,UAAS,MAAM,EAAE;AAC/B,YAAM,GAAG,MAAM,CAAC,OAAO,CAAC,UAAS,CAAC,EAAE;AAClC,eAAO,MAAM,CAAC,GAAG,CAAC,UAAS,CAAC,EAAE;AAC5B,WAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACV,iBAAO,CAAC,CAAC;SACV,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ,CAAC,CAAC;AACH,WAAO,MAAM,CAAC;GACf,CAAC;;AAEF,SAAO,CAAC,QAAQ,GAAG,UAAS,IAAI,EAAE,EAAE,EAAE;AACpC,QAAI,MAAM,CAAC;AACX,UAAM,GAAG,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;AAChC,QAAI,CAAC,OAAO,CAAC,UAAS,IAAI,EAAE;AAC1B,UAAI,EAAE,CAAC;AACP,QAAE,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;AACd,YAAM,GAAG,MAAM,CAAC,OAAO,CAAC,UAAS,KAAK,EAAE;AACtC,eAAO,EAAE,CAAC,GAAG,CAAC,UAAS,GAAG,EAAE;AAC1B,eAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAChB,iBAAO,KAAK,CAAC;SACd,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ,CAAC,CAAC;AACH,WAAO,MAAM,CAAC;GACf,CAAC;;AAEF,SAAO,CAAC,gBAAgB,GAAG,UAAS,OAAO,EAAE;AAC3C,WAAO,UAAU,CAAC,UAAS,CAAC,EAAE;AAC5B,UAAI,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC;AACd,WAAK,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;AAC9C,SAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AACf,SAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;OACX;KACF,CAAC,CAAC;GACJ,CAAC;;AAEF,WAAS,OAAO,GAAG;AACjB,QAAI,CAAC,SAAS,GAAG;AACf,OAAC,EAAE,EAAE;AACL,OAAC,EAAE,EAAE;KACN,CAAC;AACF,QAAI,CAAC,SAAS,GAAG,CAAC,CAAC;AACnB,QAAI,CAAC,MAAM,GAAG,IAAI,CAAC;GACpB;;AAED,SAAO,CAAC,SAAS,CAAC,QAAQ,GAAG,UAAS,CAAC,EAAE,IAAI,EAAE;AAC7C,QAAI,GAAG,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;AACpC,QAAI,IAAI,IAAI,IAAI,EAAE;AAChB,UAAI,GAAG,IAAI,CAAC;KACb;AACD,QAAI,IAAI,CAAC,WAAW,EAAE,EAAE;AACtB,aAAO;KACR;AACD,QAAI,CAAC,MAAM,GAAG,CAAC,CAAC;AAChB,QAAI,CAAC,SAAS,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;AAC/B,cAAU,GAAG,EAAE,CAAC;AAChB,OAAG,GAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,AAAC,CAAC;AACnD,SAAK,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;AAC1C,OAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;AACX,UAAI,UAAU,CAAC,CAAC,CAAC,EAAE;AACjB,YAAI;AACF,WAAC,CAAC,CAAC,CAAC,CAAC;SACN,CAAC,OAAO,MAAM,EAAE;AACf,aAAG,GAAG,MAAM,CAAC;AACb,oBAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACtB;OACF;KACF;AACD,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,QAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;AACzB,YAAM,+CAA+C,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC/E;GACF,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,SAAS,GAAG,UAAS,EAAE,EAAE;AACzC,QAAI,IAAI,CAAC,WAAW,EAAE,EAAE;AACtB,UAAI,IAAI,CAAC,YAAY,EAAE,EAAE;AACvB,UAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;OACjB;KACF,MAAM;AACL,UAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAC3B;GACF,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,SAAS,GAAG,UAAS,EAAE,EAAE;AACzC,QAAI,IAAI,CAAC,WAAW,EAAE,EAAE;AACtB,UAAI,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE;AACxB,UAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;OACjB;KACF,MAAM;AACL,UAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAC3B;GACF,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,UAAU,GAAG,UAAS,OAAO,EAAE,OAAO,EAAE;AACxD,QAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AACxB,QAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;GACzB,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,WAAW,GAAG,YAAW;AACzC,WAAO,IAAI,CAAC,SAAS,KAAK,CAAC,CAAC;GAC7B,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,YAAY,GAAG,YAAW;AAC1C,QAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE;AACvB,YAAM,2DAA2D,CAAC;KACnE,MAAM;AACL,aAAO,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;KAC3B;GACF,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,QAAQ,GAAG,YAAW;AACtC,WAAO,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;GAC7B,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,GAAG,GAAG,UAAS,MAAM,EAAE;AACvC,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,UAAS,CAAC,EAAE;AAC3B,iBAAO,oBAAoB,CAAC,CAAC,EAAE,YAAW;AACxC,mBAAO,MAAM,CAAC,CAAC,CAAC,CAAC;WAClB,CAAC,CAAC;SACJ,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;OAC7B,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,UAAU,EAAE;AAC/C,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,UAAS,CAAC,EAAE;AAC3B,cAAI,KAAK,CAAC;AACV,cAAI;AACF,mBAAO,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;WAC9B,CAAC,OAAO,MAAM,EAAE;AACf,iBAAK,GAAG,MAAM,CAAC;AACf,mBAAO,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;WACzB;SACF,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;OAC7B,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,MAAM,GAAG,UAAS,MAAM,EAAE;AAC1C,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,UAAS,CAAC,EAAE;AAC3B,cAAI,MAAM,CAAC,CAAC,CAAC,EAAE;AACb,mBAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;WACrB,MAAM;AACL,mBAAO,CAAC,CAAC,OAAO,CAAC,2CAA2C,CAAC,CAAC;WAC/D;SACF,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;OAC7B,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,GAAG,GAAG,UAAS,IAAI,EAAE;AACrC,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,UAAS,CAAC,EAAE;AAC3B,iBAAO,IAAI,CAAC,UAAU,CAAC,UAAS,KAAK,EAAE;AACrC,mBAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;WAC9B,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;SAC7B,EAAE,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;OAC7B,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,UAAU,GAAG,UAAS,IAAI,EAAE;AAC5C,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,UAAS,CAAC,EAAE;AACpD,iBAAO,IAAI,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,YAAW;AACzD,mBAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;WACrB,CAAC,CAAC;SACJ,CAAC,CAAC;OACJ,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,CAAC,EAAE;AACtC,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,UAAS,CAAC,EAAE;AACpD,iBAAO,oBAAoB,CAAC,CAAC,EAAE,YAAW;AACxC,mBAAO,CAAC,CAAC,CAAC,CAAC,CAAC;WACb,CAAC,CAAC;SACJ,CAAC,CAAC;OACJ,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,WAAW,GAAG,UAAS,CAAC,EAAE;AAC1C,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,UAAS,CAAC,EAAE;AACpD,cAAI,KAAK,CAAC;AACV,WAAC,CAAC,IAAI,CAAC,CAAC,YAAW;AACjB,gBAAI;AACF,qBAAO,CAAC,CAAC,CAAC,CAAC,CAAC;aACb,CAAC,OAAO,MAAM,EAAE;AACf,mBAAK,GAAG,MAAM,CAAC;AACf,qBAAO,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aAC9B;WACF,CAAA,EAAG,CAAC,CAAC;SACP,CAAC,CAAC;OACJ,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,EAAE,EAAE,EAAE,EAAE;AAC3C,WAAO,UAAU,CAAC,CAAC,UAAS,KAAK,EAAE;AACjC,aAAO,UAAS,CAAC,EAAE;AACjB,aAAK,CAAC,UAAU,CAAC,UAAS,CAAC,EAAE;AAC3B,YAAE,CAAC,CAAC,CAAC,CAAC;AACN,iBAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;SACrB,EAAE,UAAS,CAAC,EAAE;AACb,YAAE,CAAC,CAAC,CAAC,CAAC;AACN,iBAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;SACrB,CAAC,CAAC;OACJ,CAAC;KACH,CAAA,CAAE,IAAI,CAAC,CAAC,CAAC;GACX,CAAC;;AAEF,SAAO,OAAO,CAAC;CAEhB,CAAA,EAAG,CAAC;;iBAEU;AACb,QAAM,EAAE,OAAO;AACf,SAAO,EAAE,QAAQ;CAClB","file":"temp/index.js","sourcesContent":["var SFuture, SPromise, isFunction, newPromise, passFailureToPromise, passSuccessToPromise, tryCompletingPromise;\n\npassSuccessToPromise = function(p) {\n  return function(s) {\n    return p.success(s);\n  };\n};\n\npassFailureToPromise = function(p) {\n  return function(e) {\n    return p.failure(e);\n  };\n};\n\nnewPromise = function(f) {\n  var p;\n  p = new SPromise();\n  f(p);\n  return p.future();\n};\n\ntryCompletingPromise = function(p, f) {\n  var error, success, val;\n  val = null;\n  error = null;\n  success = false;\n  try {\n    val = isFunction(f) ? f() : f;\n    success = true;\n  } catch (_error) {\n    error = _error;\n  } finally {\n    if (success) {\n      p.success(val);\n    } else {\n      p.failure(error);\n    }\n  }\n};\n\nisFunction = function(a) {\n  return typeof a === \"function\";\n};\n\nSPromise = (function() {\n  SPromise.successful = function(result) {\n    var p;\n    p = new SPromise();\n    p.success(result);\n    return p;\n  };\n\n  SPromise.failed = function(err) {\n    var p;\n    p = new SPromise();\n    p.failure(err);\n    return p;\n  };\n\n  function SPromise() {\n    this._ref = null;\n  }\n\n  SPromise.prototype.future = function() {\n    if (this._ref === null) {\n      this._ref = new SFuture();\n    }\n    return this._ref;\n  };\n\n  SPromise.prototype.isCompleted = function() {\n    return this._ref !== null && this._ref.isCompleted();\n  };\n\n  SPromise.prototype.join = function(otherFuture) {\n    otherFuture.onComplete(passSuccessToPromise(this), passFailureToPromise(this));\n  };\n\n  SPromise.prototype.success = function(value) {\n    this.future().setState(value);\n  };\n\n  SPromise.prototype.failure = function(cause) {\n    this.future().setState(cause, false);\n  };\n\n  return SPromise;\n\n})();\n\nSFuture = (function() {\n  SFuture.apply = function(func, timeout) {\n    if (timeout == null) {\n      timeout = 0;\n    }\n    return newPromise(function(p) {\n      var delayedF;\n      delayedF = function() {\n        tryCompletingPromise(p, func);\n      };\n      setTimeout(delayedF, timeout);\n    });\n  };\n\n  SFuture.failed = function(err) {\n    return SPromise.failed(err).future();\n  };\n\n  SFuture.successful = function(result) {\n    return SPromise.successful(result).future();\n  };\n\n  SFuture.sequence = function(futures) {\n    var result;\n    result = SFuture.successful([]);\n    futures.forEach(function(future) {\n      result = result.flatMap(function(r) {\n        return future.map(function(v) {\n          r.push(v);\n          return r;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.traverse = function(list, fn) {\n    var result;\n    result = SFuture.successful([]);\n    list.forEach(function(item) {\n      var fb;\n      fb = fn(item);\n      result = result.flatMap(function(items) {\n        return fb.map(function(res) {\n          items.push(res);\n          return items;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.firstCompletedOf = function(futures) {\n    return newPromise(function(p) {\n      var f, i, len;\n      for (i = 0, len = futures.length; i < len; i++) {\n        f = futures[i];\n        p.join(f);\n      }\n    });\n  };\n\n  function SFuture() {\n    this._handlers = {\n      s: [],\n      f: []\n    };\n    this._stateSet = 0;\n    this._state = null;\n  }\n\n  SFuture.prototype.setState = function(s, succ) {\n    var exc, exceptions, h, i, len, ref;\n    if (succ == null) {\n      succ = true;\n    }\n    if (this.isCompleted()) {\n      return;\n    }\n    this._state = s;\n    this._stateSet = succ ? 1 : -1;\n    exceptions = [];\n    ref = (succ ? this._handlers.s : this._handlers.f);\n    for (i = 0, len = ref.length; i < len; i++) {\n      h = ref[i];\n      if (isFunction(h)) {\n        try {\n          h(s);\n        } catch (_error) {\n          exc = _error;\n          exceptions.push(exc);\n        }\n      }\n    }\n    this._handlers = null;\n    if (exceptions.length > 0) {\n      throw \"Exceptions thrown while executing callbacks: \" + exceptions.join(\", \");\n    }\n  };\n\n  SFuture.prototype.onSuccess = function(cb) {\n    if (this.isCompleted()) {\n      if (this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.s.push(cb);\n    }\n  };\n\n  SFuture.prototype.onFailure = function(cb) {\n    if (this.isCompleted()) {\n      if (!this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.f.push(cb);\n    }\n  };\n\n  SFuture.prototype.onComplete = function(success, failure) {\n    this.onSuccess(success);\n    this.onFailure(failure);\n  };\n\n  SFuture.prototype.isCompleted = function() {\n    return this._stateSet !== 0;\n  };\n\n  SFuture.prototype.isSuccessful = function() {\n    if (!this.isCompleted()) {\n      throw \"Calling isSuccessful on incomplete SFuture is not allowed\";\n    } else {\n      return this._stateSet > 0;\n    }\n  };\n\n  SFuture.prototype.isFailed = function() {\n    return !this.isSuccessful();\n  };\n\n  SFuture.prototype.map = function(mapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return tryCompletingPromise(p, function() {\n            return mapper(s);\n          });\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.flatMap = function(flatMapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          var error;\n          try {\n            return p.join(flatMapper(s));\n          } catch (_error) {\n            error = _error;\n            return p.failure(error);\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.filter = function(filter) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          if (filter(s)) {\n            return p.success(s);\n          } else {\n            return p.failure(\"SFuture.filter predicate is not satisfied\");\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.zip = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return that.onComplete(function(thatS) {\n            return p.success([s, thatS]);\n          }, passFailureToPromise(p));\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.fallbackTo = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return that.onComplete(passSuccessToPromise(p), function() {\n            return p.failure(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recover = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return tryCompletingPromise(p, function() {\n            return f(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recoverWith = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          var error;\n          p.join((function() {\n            try {\n              return f(e);\n            } catch (_error) {\n              error = _error;\n              return SFuture.failed(error);\n            }\n          })());\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.andThen = function(sf, ff) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          sf(s);\n          return p.success(s);\n        }, function(e) {\n          ff(e);\n          return p.failure(e);\n        });\n      };\n    })(this));\n  };\n\n  return SFuture;\n\n})();\n\nexport default {\n  Future: SFuture,\n  Promise: SPromise\n};\n"]}