{"version":3,"sources":["../../temp/index.js"],"names":[],"mappings":"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","file":"temp/index.js","sourcesContent":["var SFuture, SPromise, isFunction, newPromise, passFailureToPromise, passSuccessToPromise, tryCompletingPromise;\n\npassSuccessToPromise = function(p) {\n  return function(s) {\n    return p.success(s);\n  };\n};\n\npassFailureToPromise = function(p) {\n  return function(e) {\n    return p.failure(e);\n  };\n};\n\nnewPromise = function(f) {\n  var p;\n  p = new SPromise();\n  f(p);\n  return p.future();\n};\n\ntryCompletingPromise = function(p, f) {\n  var error, success, val;\n  val = null;\n  error = null;\n  success = false;\n  try {\n    val = isFunction(f) ? f() : f;\n    success = true;\n  } catch (_error) {\n    error = _error;\n  } finally {\n    if (success) {\n      p.success(val);\n    } else {\n      p.failure(error);\n    }\n  }\n};\n\nisFunction = function(a) {\n  return typeof a === \"function\";\n};\n\nSPromise = (function() {\n  SPromise.successful = function(result) {\n    var p;\n    p = new SPromise();\n    p.success(result);\n    return p;\n  };\n\n  SPromise.failed = function(err) {\n    var p;\n    p = new SPromise();\n    p.failure(err);\n    return p;\n  };\n\n  function SPromise() {\n    this._ref = null;\n  }\n\n  SPromise.prototype.future = function() {\n    if (this._ref === null) {\n      this._ref = new SFuture();\n    }\n    return this._ref;\n  };\n\n  SPromise.prototype.isCompleted = function() {\n    return this._ref !== null && this._ref.isCompleted();\n  };\n\n  SPromise.prototype.join = function(otherFuture) {\n    otherFuture.onComplete(passSuccessToPromise(this), passFailureToPromise(this));\n  };\n\n  SPromise.prototype.success = function(value) {\n    this.future().setState(value);\n  };\n\n  SPromise.prototype.failure = function(cause) {\n    this.future().setState(cause, false);\n  };\n\n  return SPromise;\n\n})();\n\nSFuture = (function() {\n  SFuture.apply = function(func, timeout) {\n    if (timeout == null) {\n      timeout = 0;\n    }\n    return newPromise(function(p) {\n      var delayedF;\n      delayedF = function() {\n        tryCompletingPromise(p, func);\n      };\n      setTimeout(delayedF, timeout);\n    });\n  };\n\n  SFuture.failed = function(err) {\n    return SPromise.failed(err).future();\n  };\n\n  SFuture.successful = function(result) {\n    return SPromise.successful(result).future();\n  };\n\n  SFuture.sequence = function(futures) {\n    var result;\n    result = SFuture.successful([]);\n    futures.forEach(function(future) {\n      result = result.flatMap(function(r) {\n        return future.map(function(v) {\n          r.push(v);\n          return r;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.traverse = function(list, fn) {\n    var result;\n    result = SFuture.successful([]);\n    list.forEach(function(item) {\n      var fb;\n      fb = fn(item);\n      result = result.flatMap(function(items) {\n        return fb.map(function(res) {\n          items.push(res);\n          return items;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.firstCompletedOf = function(futures) {\n    return newPromise(function(p) {\n      var f, i, len;\n      for (i = 0, len = futures.length; i < len; i++) {\n        f = futures[i];\n        p.join(f);\n      }\n    });\n  };\n\n  function SFuture() {\n    this._handlers = {\n      s: [],\n      f: []\n    };\n    this._stateSet = 0;\n    this._state = null;\n  }\n\n  SFuture.prototype.setState = function(s, succ) {\n    var exc, exceptions, h, i, len, ref;\n    if (succ == null) {\n      succ = true;\n    }\n    if (this.isCompleted()) {\n      return;\n    }\n    this._state = s;\n    this._stateSet = succ ? 1 : -1;\n    exceptions = [];\n    ref = (succ ? this._handlers.s : this._handlers.f);\n    for (i = 0, len = ref.length; i < len; i++) {\n      h = ref[i];\n      if (isFunction(h)) {\n        try {\n          h(s);\n        } catch (_error) {\n          exc = _error;\n          exceptions.push(exc);\n        }\n      }\n    }\n    this._handlers = null;\n    if (exceptions.length > 0) {\n      throw \"Exceptions thrown while executing callbacks: \" + exceptions.join(\", \");\n    }\n  };\n\n  SFuture.prototype.onSuccess = function(cb) {\n    if (this.isCompleted()) {\n      if (this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.s.push(cb);\n    }\n  };\n\n  SFuture.prototype.onFailure = function(cb) {\n    if (this.isCompleted()) {\n      if (!this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.f.push(cb);\n    }\n  };\n\n  SFuture.prototype.onComplete = function(success, failure) {\n    this.onSuccess(success);\n    this.onFailure(failure);\n  };\n\n  SFuture.prototype.isCompleted = function() {\n    return this._stateSet !== 0;\n  };\n\n  SFuture.prototype.isSuccessful = function() {\n    if (!this.isCompleted()) {\n      throw \"Calling isSuccessful on incomplete SFuture is not allowed\";\n    } else {\n      return this._stateSet > 0;\n    }\n  };\n\n  SFuture.prototype.isFailed = function() {\n    return !this.isSuccessful();\n  };\n\n  SFuture.prototype.map = function(mapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return tryCompletingPromise(p, function() {\n            return mapper(s);\n          });\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.flatMap = function(flatMapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          var error;\n          try {\n            return p.join(flatMapper(s));\n          } catch (_error) {\n            error = _error;\n            return p.failure(error);\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.filter = function(filter) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          if (filter(s)) {\n            return p.success(s);\n          } else {\n            return p.failure(\"SFuture.filter predicate is not satisfied\");\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.zip = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return that.onComplete(function(thatS) {\n            return p.success([s, thatS]);\n          }, passFailureToPromise(p));\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.fallbackTo = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return that.onComplete(passSuccessToPromise(p), function() {\n            return p.failure(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recover = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return tryCompletingPromise(p, function() {\n            return f(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recoverWith = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          var error;\n          p.join((function() {\n            try {\n              return f(e);\n            } catch (_error) {\n              error = _error;\n              return SFuture.failed(error);\n            }\n          })());\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.andThen = function(sf, ff) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          sf(s);\n          return p.success(s);\n        }, function(e) {\n          ff(e);\n          return p.failure(e);\n        });\n      };\n    })(this));\n  };\n\n  return SFuture;\n\n})();\n\nexport default {\n  Future: SFuture,\n  Promise: SPromise\n};\n"]}