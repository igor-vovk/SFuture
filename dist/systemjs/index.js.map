{"version":3,"sources":["../../temp/index.js"],"names":[],"mappings":"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","file":"temp/index.js","sourcesContent":["var SFuture, SPromise, isFunction, newPromise, passFailureToPromise, passSuccessToPromise, tryCompletingPromise;\n\npassSuccessToPromise = function(p) {\n  return function(s) {\n    return p.success(s);\n  };\n};\n\npassFailureToPromise = function(p) {\n  return function(e) {\n    return p.failure(e);\n  };\n};\n\nnewPromise = function(f) {\n  var p;\n  p = new SPromise();\n  f(p);\n  return p.future();\n};\n\ntryCompletingPromise = function(p, f) {\n  var error, success, val;\n  val = null;\n  error = null;\n  success = false;\n  try {\n    val = isFunction(f) ? f() : f;\n    success = true;\n  } catch (_error) {\n    error = _error;\n  } finally {\n    if (success) {\n      p.success(val);\n    } else {\n      p.failure(error);\n    }\n  }\n};\n\nisFunction = function(a) {\n  return typeof a === \"function\";\n};\n\nSPromise = (function() {\n  SPromise.successful = function(result) {\n    var p;\n    p = new SPromise();\n    p.success(result);\n    return p;\n  };\n\n  SPromise.failed = function(err) {\n    var p;\n    p = new SPromise();\n    p.failure(err);\n    return p;\n  };\n\n  function SPromise() {\n    this._ref = null;\n  }\n\n  SPromise.prototype.future = function() {\n    if (this._ref === null) {\n      this._ref = new SFuture();\n    }\n    return this._ref;\n  };\n\n  SPromise.prototype.isCompleted = function() {\n    return this._ref !== null && this._ref.isCompleted();\n  };\n\n  SPromise.prototype.join = function(otherFuture) {\n    otherFuture.onComplete(passSuccessToPromise(this), passFailureToPromise(this));\n  };\n\n  SPromise.prototype.success = function(value) {\n    this.future().setState(value);\n  };\n\n  SPromise.prototype.failure = function(cause) {\n    this.future().setState(cause, false);\n  };\n\n  return SPromise;\n\n})();\n\nSFuture = (function() {\n  SFuture.apply = function(func, timeout) {\n    if (timeout == null) {\n      timeout = 0;\n    }\n    return newPromise(function(p) {\n      var delayedF;\n      delayedF = function() {\n        tryCompletingPromise(p, func);\n      };\n      setTimeout(delayedF, timeout);\n    });\n  };\n\n  SFuture.failed = function(err) {\n    return SPromise.failed(err).future();\n  };\n\n  SFuture.successful = function(result) {\n    return SPromise.successful(result).future();\n  };\n\n  SFuture.sequence = function(futures) {\n    var result;\n    result = SFuture.successful([]);\n    futures.forEach(function(future) {\n      result = result.flatMap(function(r) {\n        return future.map(function(v) {\n          r.push(v);\n          return r;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.traverse = function(list, fn) {\n    var result;\n    result = SFuture.successful([]);\n    list.forEach(function(item) {\n      var fb;\n      fb = fn(item);\n      result = result.flatMap(function(items) {\n        return fb.map(function(res) {\n          items.push(res);\n          return items;\n        });\n      });\n    });\n    return result;\n  };\n\n  SFuture.firstCompletedOf = function(futures) {\n    return newPromise(function(p) {\n      var f, i, len;\n      for (i = 0, len = futures.length; i < len; i++) {\n        f = futures[i];\n        p.join(f);\n      }\n    });\n  };\n\n  function SFuture() {\n    this._handlers = {\n      s: [],\n      f: []\n    };\n    this._stateSet = 0;\n    this._state = null;\n  }\n\n  SFuture.prototype.setState = function(s, succ) {\n    var exc, exceptions, h, i, len, ref;\n    if (succ == null) {\n      succ = true;\n    }\n    if (this.isCompleted()) {\n      return;\n    }\n    this._state = s;\n    this._stateSet = succ ? 1 : -1;\n    exceptions = [];\n    ref = (succ ? this._handlers.s : this._handlers.f);\n    for (i = 0, len = ref.length; i < len; i++) {\n      h = ref[i];\n      if (isFunction(h)) {\n        try {\n          h(s);\n        } catch (_error) {\n          exc = _error;\n          exceptions.push(exc);\n        }\n      }\n    }\n    this._handlers = null;\n    if (exceptions.length > 0) {\n      throw \"Exceptions thrown while executing callbacks: \" + exceptions.join(\", \");\n    }\n  };\n\n  SFuture.prototype.onSuccess = function(cb) {\n    if (this.isCompleted()) {\n      if (this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.s.push(cb);\n    }\n  };\n\n  SFuture.prototype.onFailure = function(cb) {\n    if (this.isCompleted()) {\n      if (!this.isSuccessful()) {\n        cb(this._state);\n      }\n    } else {\n      this._handlers.f.push(cb);\n    }\n  };\n\n  SFuture.prototype.onComplete = function(success, failure) {\n    this.onSuccess(success);\n    this.onFailure(failure);\n  };\n\n  SFuture.prototype.isCompleted = function() {\n    return this._stateSet !== 0;\n  };\n\n  SFuture.prototype.isSuccessful = function() {\n    if (!this.isCompleted()) {\n      throw \"Calling isSuccessful on incomplete SFuture is not allowed\";\n    } else {\n      return this._stateSet > 0;\n    }\n  };\n\n  SFuture.prototype.isFailed = function() {\n    return !this.isSuccessful();\n  };\n\n  SFuture.prototype.map = function(mapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return tryCompletingPromise(p, function() {\n            return mapper(s);\n          });\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.flatMap = function(flatMapper) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          var error;\n          try {\n            return p.join(flatMapper(s));\n          } catch (_error) {\n            error = _error;\n            return p.failure(error);\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.filter = function(filter) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          if (filter(s)) {\n            return p.success(s);\n          } else {\n            return p.failure(\"SFuture.filter predicate is not satisfied\");\n          }\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.zip = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          return that.onComplete(function(thatS) {\n            return p.success([s, thatS]);\n          }, passFailureToPromise(p));\n        }, passFailureToPromise(p));\n      };\n    })(this));\n  };\n\n  SFuture.prototype.fallbackTo = function(that) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return that.onComplete(passSuccessToPromise(p), function() {\n            return p.failure(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recover = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          return tryCompletingPromise(p, function() {\n            return f(e);\n          });\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.recoverWith = function(f) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(passSuccessToPromise(p), function(e) {\n          var error;\n          p.join((function() {\n            try {\n              return f(e);\n            } catch (_error) {\n              error = _error;\n              return SFuture.failed(error);\n            }\n          })());\n        });\n      };\n    })(this));\n  };\n\n  SFuture.prototype.andThen = function(sf, ff) {\n    return newPromise((function(_this) {\n      return function(p) {\n        _this.onComplete(function(s) {\n          sf(s);\n          return p.success(s);\n        }, function(e) {\n          ff(e);\n          return p.failure(e);\n        });\n      };\n    })(this));\n  };\n\n  return SFuture;\n\n})();\n\nexport default {\n  Future: SFuture,\n  Promise: SPromise\n};\n"]}